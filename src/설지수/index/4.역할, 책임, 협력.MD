## 역할,책임,협력
인간이 어떤 본질적인 특성을 지니고 있느냐가 아니라 어떤 상황에 처해 있느냐가 인간의 행동을 결정한다.
각 개인이 처해 있는 정황 또는 문맥이 인간의 행동 방식을 결정한다는 것이다.
이 실험에서 인간의 행동을 결정하는 문맥은 타인과의 협력이다. 객체의 세계에서도 완전히 같다.
객체지향에 갓 입문한 사람들의 가장 흔한 실수는 협력이라는 문맥을 고려하지 않고 객체가 가져야 할
상태와 행동부터 고민하기 시작한다는 것이다.
중요한 것은 객체들 사이에 이뤄지는 협력이다. 협력이 자리를 잡으면 저절로 객체의 행동이 드러나고
뒤이어 적절한 객체의 상태가 결정된다.

협력의 본질은 요청과 응답으로 연결되는 사람들의 네트워크, 즉 `관계`다.

이 책에서 앨리스의 이야기 중 하트 여왕의 파이을 훔친 혐의를 받는 하트 잭을 처벌하기 위해 재판을
하는 과정이 있는데, 이 재판 과정을 흐름대로 서술해보겠다.

### 재판 속의 협력

- `누군가`가 `왕`에게 재판을 `요청`함으로써 재판이 시작된다.
- `왕`이 `하얀 토끼`에게 증인을 부를 것을 `요청`한다.
- 왕의 요청을 받은 토끼는 `모자 장수`에게 증인석으로 입장할 것을 `요청`한다.
- 모자 장수는 증인석에 입장함으로써 토끼의 요청에 `응답`한다.
- 모자 장수의 입장은 왕이 토끼에게 요청했던 증인 호출에 대한 `응답`이기도 하다.
- 이제 왕은 모자 장수에게 증언할 것을 `요청`한다.
- 모자 장수는 자신이 알고 있는 내용을 증언함으로써 왕의 요청에 `응답`한다.

```java
package 설지수.chapter4.ex;


public class TrialMain {

    public static void main(String[] args) {
        //  - 누군가가 왕에게 재판을 요청함으로써 재판이 시작된다.
        Someone someone = new Someone();
        King king = new King();
        Rabbit rabbit = new Rabbit();
        someone.requestTrial(king);

//  - 왕이 하얀 토끼에게 증인을 부를 것을 요청한다.
//  - 모자 장수는 증인석에 입장함으로써 토끼의 요청에 응답한다.
//  - 모자 장수의 입장은 왕이 토끼에게 요청했던 증인 호출에 대한 응답이기도 하다.
        Merchant merchant = king.callWitnessByRabbit(rabbit);

//  - 이제 왕은 모자 장수에게 증언할 것을 요청한다.
        king.requestTestimony(merchant);
    }
}

```
```console
C:\Users\82106\.jdks\temurin-21.0.3\bin\java.exe "-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2024.1.1\lib\idea_rt.jar=61212:C:\Program Files\JetBrains\IntelliJ IDEA 2024.1.1\bin" -Dfile.encoding=UTF-8 -Dsun.stdout.encoding=UTF-8 -Dsun.stderr.encoding=UTF-8 -classpath C:\JAVA\BookStudy\Book_study_copy\out\production\BookStudy01 설지수.chapter4.ex.TrialMain
재판해주세요
재판 시작하겠습니다.
토끼야 증인 불러라
증인 입장하겠습니다.
증언해봐라
상인인 제가 증언해보겠습니다 어쩌구 저쩌구..

Process finished with exit code 0
```
(위에 흐름을 작성한 코드와 결과창)

이 재판이라는 **이벤트(협력)** 안에 요청과 응답에 초점을 맞춰 보자.

왕이 토끼에게 증인을 불러오라고 `요청`한 이유는 토끼가 목격자에 대해 알고 있으며 동시에 목격자를 부를 `의무`가 있기 때문이다.
왕이 모자 장수에게 증언하라고 `요청`한 이유는 모자 장수가 재판에 도움이 될 만한 사건의 내용에 대해
조금이라도 알고 있으며 증언할 `의무`가 있기 때문이다.
결국 **요청과 응답은 협력에 참여하는 객체가 수행할 책임을 정의**한다.

### 책임
객체지향의 세계에서는 어떤 객체가 어떤 요청에 대해 대답해 줄 수 있거나, 적절한 핸동을 할 의무가 있는 경우
해당 객체가 책임을 가진다고 말한다.

책임은 객체지향 설계의 가장 중요한 재료다.
        

객체와 책임이 이리저리 부유하는 상황에서 성급하게 구현에 뛰어드는 것은 변경에 취약하고 다양한 협력에
참여할 수 없는 비자율적인 객체를 낳게 된다.

협력에 참여하는 객체들은 목표를 달성하는 데 필요한 책임을 수행한다.
객체의 책임은 `객체가 무엇을 알고 있는가(Knowing)`과 `무엇을 할 수 있는가(doing)`로 구성된다.

책임은 객체지향 설계의 품질을 결정하는 가장 중요한 요소다. 객체지향 설계의 예술은 **적절한 객체에게
적절한 책임을 할당**하는데 있다.
객체의 책임을 이야기할 때는 일반적으로 외부에서 접근 가능한 공용 서비스의 관점에서 이야기한다.
즉, 책임은 객체의 공용 인터페이스를 구성한다.

### 책임과 메시지
협력 안에서 객체는 다른 객체로부터 요청이 전송됐을 경우에만 자신에게 주어진 책임을 수행한다.
토끼가 모자 장수를 증인석으로 불러들이는 때는 왕으로부터 목격자를 부르라는 요청을 받았을 때뿐이다.
모자 장수가 자신의 책임을 완수하기 위해 증언을 하는 이유는 왕으로부터 요청이 수신됐기 때문이다.

이처럼 객체가 다른 객체에게 주어진 책임을 수행하도록 요청을 보내는 것을 **메시지 전송**이라 한다.
메시지를 전송함으로써 협력을 요청하는 객체를 `송신자`라고 하고, 메시지를 받아 요청을 처리하는 객체를
`수신자`라 한다.
메시지는 협력을 위해 한 객체가 다른 객체로 접근할 수 있는 유일한 방법이다.

주의할 점은 책임과 메시지의 수준이 같지는 않다는 점이다.

### 역할

위에 구현한 코드에서 재판이라는 협력에 참여하기 위해 모자 장수는 `증인`이라는 역할을 수행하고
왕은 `판사` 라는 역할을 수행하고 있음을 의미한다.
왕은 왕일 뿐이고 상인은 상인일 뿐인데 굳이 왕을 판사라고 부르고 상인을 증인이라고 불러서
상황을 복잡하게 만드는 이유는 무엇인가?

그것은 **역할이 재사용 가능하고 유연한 객체지향 설계를 낳는 매우 중요한 구성 요소**이기 때문이다.

그 뒤에 이야기를 간략하게 서술해보겠다.
모자 장수가 증언을 마치고 쏜살같이 법정을 빠져 나갔다.
"다음 증인을 불러라" 왕이 하얀 토끼에게 명령했다. 다음 증인은 공작 부인의 요리사였다.
똑같이 입장하고 요리사는 증언한다.

위의 내용을 흐름으로 써본다면
- `왕`에게 재판을 요청함으로써 재판이 시작된다.
- `왕`의 요청을 받은 `토끼`는 `요리사`에게 증인석으로 입장할 것을 요청한다.
- `요리사`는 증인석에 입장함으로써 `토끼`의 요청에 응답한다.
- 이제 `왕`은 `요리사`에게 증언할 것을 요청한다.
- `요리사`는 자신이 알고 있는 내용을 증언함으로써 `왕`의 요청에 응답한다.

재판이 이뤄지는 흐름이 위에 있던 흐름과 너무나도 동일하지 않은가?
차이점이라면 `모자 장수` 대신 `요리사`가 협력에 참여한다는 것 뿐이다.
하지만 위에 코드에선 요리사라는 책임이 등장한다면 협력 과정을 일일히 쫓아가며
바꿔야 한다는 단점이 있었다. 그것을 고쳐보겠다.

```java
package 설지수.chapter4;

public class TrialMain {

    public static void main(String[] args) {

//  - 누군가가 왕에게 재판을 요청함으로써 재판이 시작된다.
        Someone someone = new Someone();
        King king = new King();
        Rabbit rabbit = new Rabbit();
        someone.requestTrial(king);

//  - 왕이 하얀 토끼에게 증인을 부를 것을 요청한다.
//  - 요리사는 증인석에 입장함으로써 토끼의 요청에 응답한다.
//  - 요리사의 입장은 왕이 토끼에게 요청했던 증인 호출에 대한 응답이기도 하다.
        rabbit.setWitnessName("Merchant");
        Witness witness = king.callWitnessByRabbit(rabbit);

//  - 이제 왕은 요리사에게 증언할 것을 요청한다.
        king.requestTestimony(witness);

    }
}

```
```java
package 설지수.chapter4;

public abstract class Witness {

    //  - 증인은 자신이 알고 있는 내용을 증언함으로써 왕의 요청에 응답한다.
    public void testify() {
        System.out.println("제가 증언해보겠습니다. 어쩌구 저쩌구");
    }
}

```
```java
package 설지수.chapter4;

public class Rabbit {
    private String witnessName;
    //  - 왕의 요청을 받은 토끼는 증인에게 증인석으로 입장할 것을 요청한다.
    public Witness callWitness() {
        System.out.println("증인 입장하겠습니다.");
        return FactoryWitness.createWitness(witnessName);
    }

    public void setWitnessName(String witnessName) {
        this.witnessName = witnessName;
    }
}

```
```java
package 설지수.chapter4;

public abstract class FactoryWitness {
    // 증인의 이름을 비교하여 반환하는 로직
    public static Witness createWitness(String witnessName) {
        if (witnessName.equals("Merchant")) {
            return new Merchant();
        } else if (witnessName.equals("Cook")) {
            return new Cook();
        }
        return null;
    }
}

```
위 코드에서 Main 내에서 `Merchant`를 바로 쓰는게 아닌, 이름에 맞게 그 증인을
호출할 수 있게 바꾸었다. 그렇게 하기 위해 `rabbit`만 증인의 이름을 알게 하기 위하여
필드와 메서드를 추가하였고, `FactoryWitness`라는 클래스를 추가하였다.

이 코드 내에서 요리사와 모자 장수는 똑같은 역할을 수행한다.
동일한 역할을 수행할 수 있다는 것은 해당 객체들이 협력 내에서 동일한
책임의 집합을 수행할 수 있다는 것을 의미한다. 이 개념을 제대로 이해해야만
객체지향이 제공하는 많은 장점을 누릴 수 있다.

결국 **역할은 객체지향 설계의 단순성(simplicity), 유연성(flexibility), 재사용성(reusability)을
뒷받침하는 핵심 개념이다.**

### 대체 가능성
역할은 협력 안에서 구체적인 객체로 대체될 수 있는 추상적인 협력자다.
따라서 역할은 **다른 객체에 의해 대체 가능함**을 의미한다.

객체가 역할에 주어진 책임 외에 다른 책임을 수행할 수도 있다는 사실에 주목하라.
증인의 역할을 수행할 수 있는 상인은 증인을 할 책임뿐만 아니라 모자를 판매할
모자 장수로서의 본질적인 책임을 가지고 있다.

요약하면 **역할의 대체 가능성은 행위 호환성을 의미하고, 행위 호환성은 동일한 책임의 수행**을 의미한다.

### 객체지향 설계 기법

- **책임-주도 설계(Responsibility-Driven Design)** :
협력에 필요한 책임들을 식별하고 적합한 객체에게 책임을 할당하는 방식
- **디자인 패턴(Design Pattern)** :
전문가들이 반복적으로 사용하는 해결 방법을 정의해 놓은 설계 템플릿의 모음
- **테스트-주도 개발(Test-Driven Development)** :
테스트를 먼저 작성하고 테스트를 통과하는 구체적인 코드를 추가하면서 애플리케이션을 완성하는 방식

이번 장에서는 객체지향 설계의 품질을 결정하는 역할, 책임, 협력에 관해 살펴보았다.
이걸 읽으면서 좀 더 역할과 책임의 개념이 내가 알던 것과 다르다는 것을 알았고,
개념을 더 확실히 정립할 수 있었다. 역할과 책임도 중요하지만, 더더욱 협력이 중요하다는 것을 몸소 느꼈다.
